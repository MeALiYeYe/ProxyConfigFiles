name: Sync Gist to ProxyConfigFiles

on:
  schedule:
    - cron: '0 * * * *'  # 每小时同步一次，你可以根据需要调整这个定时器
  workflow_dispatch:  # 允许手动触发

jobs:
  sync:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v3  # 获取仓库代码

      - name: Get Gist content
        run: |
          # 使用 Gist 的 API 获取代码内容，替换 {gist_id} 为你实际的 Gist ID
          curl -H "Authorization: token ${{ secrets.GITHUB_TOKEN }}" \
            https://api.github.com/gists/{gist_id} > gist.json

      - name: Extract code from Gist
        run: |
          # 提取 Gist 文件中的代码内容，假设代码在 Gist 的第一个文件中
          GIST_CONTENT=$(cat gist.json | jq -r '.files[].content')
          echo "$GIST_CONTENT" > Egern/Egern.yaml

      - name: Commit changes to repository
        run: |
          git config user.name "github-actions"
          git config user.email "github-actions@github.com"
          git add Egern/Egern.yaml
          git commit -m "Sync Gist content to Egern.yaml"
          git push
